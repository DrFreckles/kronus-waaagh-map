<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Kronus - WAAAGH! Territory Map</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: radial-gradient(circle, #0a0a0a 0%, #000000 100%);
            font-family: 'Courier New', monospace;
            color: #00ff00;
        }
        
        .map-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            height: 800px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            border-radius: 20px;
            border: 4px solid #00ff00;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.3), inset 0 0 100px rgba(0, 0, 0, 0.3);
            overflow: visible;
        }
        
        /* Landmass background */
        .continent {
            position: absolute;
            background: linear-gradient(45deg, #3a5a2a 0%, #2d4a22 50%, #4a6a3a 100%);
            border-radius: 40% 60% 70% 30%;
            top: 15%;
            left: 20%;
            width: 60%;
            height: 70%;
            opacity: 0.7;
            transform: rotate(-10deg);
        }
        
        /* Mountain ranges */
        .mountain-range {
            position: absolute;
            background: linear-gradient(135deg, #606060 0%, #404040 50%, #505050 100%);
            border-radius: 60% 40% 50% 60%;
            opacity: 0.8;
        }
        
        .mountains-north {
            top: 10%;
            right: 15%;
            width: 25%;
            height: 20%;
            transform: rotate(30deg);
        }
        
        .mountains-central {
            top: 45%;
            left: 40%;
            width: 20%;
            height: 15%;
            transform: rotate(-20deg);
        }
        
        .mountains-south {
            bottom: 25%;
            left: 35%;
            width: 18%;
            height: 12%;
            transform: rotate(45deg);
        }
        
        /* Desert areas */
        .desert-area {
            position: absolute;
            background: radial-gradient(circle, #d2b48c 0%, #daa520 40%, #b8860b 100%);
            border-radius: 70% 30% 40% 60%;
            opacity: 0.6;
        }
        
        .desert-central {
            top: 35%;
            left: 42%;
            width: 18%;
            height: 22%;
        }
        
        .desert-south {
            bottom: 20%;
            right: 25%;
            width: 15%;
            height: 18%;
            transform: rotate(20deg);
        }
        
        /* Jungle areas */
        .jungle-area {
            position: absolute;
            background: radial-gradient(ellipse, #228b22 0%, #006400 60%, #2e8b57 100%);
            border-radius: 50% 70% 60% 40%;
            opacity: 0.7;
        }
        
        .jungle-southwest {
            bottom: 15%;
            left: 15%;
            width: 22%;
            height: 25%;
            transform: rotate(-15deg);
        }
        
        .jungle-east {
            top: 55%;
            left: 15%;
            width: 15%;
            height: 20%;
            transform: rotate(30deg);
        }
        
        /* Coastal lines */
        .coastline {
            position: absolute;
            border: 2px solid #4682b4;
            border-radius: 50%;
            opacity: 0.5;
        }
        
        .coast-north {
            top: 5%;
            right: 10%;
            width: 30%;
            height: 15%;
            border-bottom: none;
            border-left: none;
        }
        
        .coast-east {
            top: 25%;
            right: 5%;
            width: 15%;
            height: 40%;
            border-left: none;
            border-top: none;
            border-bottom: none;
        }
        
        /* Territory markers */
        .territory {
            position: absolute;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 8px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.3) 100%);
        }
        
        .territory:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }
        
        /* Stronghold territories - larger and more prominent */
        .stronghold {
            width: 80px;
            height: 80px;
            border-width: 4px;
            font-size: 9px;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        /* Regular territories */
        .contested {
            width: 50px;
            height: 50px;
            border-width: 2px;
            font-size: 7px;
        }
        
        /* Terrain type colors */
        .mountain { border-color: #888888; color: #ffffff; background: radial-gradient(circle, rgba(136,136,136,0.4), rgba(64,64,64,0.6)); }
        .desert { border-color: #daa520; color: #8b4513; background: radial-gradient(circle, rgba(218,165,32,0.4), rgba(184,134,11,0.6)); }
        .jungle { border-color: #32cd32; color: #ffffff; background: radial-gradient(circle, rgba(50,205,50,0.4), rgba(34,139,34,0.6)); }
        .urban { border-color: #a9a9a9; color: #ffffff; background: radial-gradient(circle, rgba(169,169,169,0.4), rgba(105,105,105,0.6)); }
        .death { border-color: #ff0000; color: #ffffff; background: radial-gradient(circle, rgba(255,0,0,0.4), rgba(139,0,0,0.6)); }
        .mek { border-color: #87ceeb; color: #000000; background: radial-gradient(circle, rgba(135,206,235,0.4), rgba(70,130,180,0.6)); }
        .civilized { border-color: #da70d6; color: #000000; background: radial-gradient(circle, rgba(218,112,214,0.4), rgba(221,160,221,0.6)); }
        .flatland { border-color: #7cfc00; color: #000000; background: radial-gradient(circle, rgba(124,252,0,0.4), rgba(154,205,50,0.6)); }
        
        /* WAAAGH! Ownership Colors - Override terrain colors when claimed */
        .owned-by-reginald { 
            border-color: #ff0000 !important; 
            background: radial-gradient(circle, rgba(255,0,0,0.4), rgba(139,0,0,0.6)) !important; 
            color: #ffffff !important;
        }
        .owned-by-twoferone { 
            border-color: #ffff00 !important; 
            background: radial-gradient(circle, rgba(255,255,0,0.4), rgba(218,165,32,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-loraghzneckcrusha { 
            border-color: #800080 !important; 
            background: radial-gradient(circle, rgba(128,0,128,0.4), rgba(75,0,130,0.6)) !important; 
            color: #ffffff !important;
        }
        .owned-by-norfskarills { 
            border-color: #ffa500 !important; 
            background: radial-gradient(circle, rgba(255,165,0,0.4), rgba(255,140,0,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-greenfist { 
            border-color: #00ff00 !important; 
            background: radial-gradient(circle, rgba(0,255,0,0.4), rgba(0,128,0,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-blacktooth { 
            border-color: #ffffff !important; 
            background: radial-gradient(circle, rgba(255,255,255,0.4), rgba(128,128,128,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-redskull { 
            border-color: #8b0000 !important; 
            background: radial-gradient(circle, rgba(139,0,0,0.4), rgba(205,92,92,0.6)) !important; 
            color: #ffffff !important;
        }
        .owned-by-bonekrakka { 
            border-color: #00ffff !important; 
            background: radial-gradient(circle, rgba(0,255,255,0.4), rgba(0,139,139,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-thugskull { 
            border-color: #ff69b4 !important; 
            background: radial-gradient(circle, rgba(255,105,180,0.4), rgba(199,21,133,0.6)) !important; 
            color: #000000 !important;
        }
        .owned-by-rippa { 
            border-color: #32cd32 !important; 
            background: radial-gradient(circle, rgba(50,205,50,0.4), rgba(34,139,34,0.6)) !important; 
            color: #ffffff !important;
        }
        .owned-by-scrapfist { 
            border-color: #daa520 !important; 
            background: radial-gradient(circle, rgba(218,165,32,0.4), rgba(184,134,11,0.6)) !important; 
            color: #000000 !important;
        }

        /* ========================================
           SHARED TERRITORY CONTROL STYLES
           ======================================== */

        /* Two-way shared control - Reginald combinations */
        .shared-reginald-twoferone {
            background: linear-gradient(45deg, #ff0000 50%, #ffff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-reginald-loraghzneckcrusha {
            background: linear-gradient(45deg, #ff0000 50%, #800080 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-reginald-norfskarills {
            background: linear-gradient(45deg, #ff0000 50%, #ffa500 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-reginald-greenfist {
            background: linear-gradient(45deg, #ff0000 50%, #00ff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-reginald-blacktooth {
            background: linear-gradient(45deg, #ff0000 50%, #ffffff 50%) !important;
            border: 4px solid #000000 !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-reginald-redskull {
            background: linear-gradient(45deg, #ff0000 50%, #8b0000 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-reginald-bonekrakka {
            background: linear-gradient(45deg, #ff0000 50%, #00ffff 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-reginald-thugskull {
            background: linear-gradient(45deg, #ff0000 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-reginald-rippa {
            background: linear-gradient(45deg, #ff0000 50%, #32cd32 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-reginald-scrapfist {
            background: linear-gradient(45deg, #ff0000 50%, #daa520 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        /* Twoferone combinations */
        .shared-twoferone-loraghzneckcrusha {
            background: linear-gradient(45deg, #ffff00 50%, #800080 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-twoferone-norfskarills {
            background: linear-gradient(45deg, #ffff00 50%, #ffa500 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-greenfist {
            background: linear-gradient(45deg, #ffff00 50%, #00ff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-blacktooth {
            background: linear-gradient(45deg, #ffff00 50%, #ffffff 50%) !important;
            border: 4px solid #000000 !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-redskull {
            background: linear-gradient(45deg, #ffff00 50%, #8b0000 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-twoferone-bonekrakka {
            background: linear-gradient(45deg, #ffff00 50%, #00ffff 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-thugskull {
            background: linear-gradient(45deg, #ffff00 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-rippa {
            background: linear-gradient(45deg, #ffff00 50%, #32cd32 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-twoferone-scrapfist {
            background: linear-gradient(45deg, #ffff00 50%, #daa520 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        /* Loraghz Neckcrusha combinations */
        .shared-loraghzneckcrusha-norfskarills {
            background: linear-gradient(45deg, #800080 50%, #ffa500 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* Additional missing combinations */
        .shared-greenfist-twoferone {
            background: linear-gradient(45deg, #00ff00 50%, #ffff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-blacktooth-reginald {
            background: linear-gradient(45deg, #ffffff 50%, #ff0000 50%) !important;
            border: 4px solid #000000 !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-bonekrakka-thugskull {
            background: linear-gradient(45deg, #00ffff 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-rippa-scrapfist {
            background: linear-gradient(45deg, #32cd32 50%, #daa520 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-bonekrakka-redskull {
            background: linear-gradient(45deg, #00ffff 50%, #8b0000 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-greenfist-thugskull {
            background: linear-gradient(45deg, #00ff00 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-loraghzneckcrusha {
            background: linear-gradient(45deg, #ffa500 50%, #800080 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-norfskarills {
            background: linear-gradient(45deg, #800080 50%, #ffa500 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-greenfist {
            background: linear-gradient(45deg, #800080 50%, #00ff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-blacktooth {
            background: linear-gradient(45deg, #800080 50%, #ffffff 50%) !important;
            border: 4px solid #000000 !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-redskull {
            background: linear-gradient(45deg, #800080 50%, #8b0000 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-bonekrakka {
            background: linear-gradient(45deg, #800080 50%, #00ffff 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-thugskull {
            background: linear-gradient(45deg, #800080 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-rippa {
            background: linear-gradient(45deg, #800080 50%, #32cd32 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-loraghzneckcrusha-scrapfist {
            background: linear-gradient(45deg, #800080 50%, #daa520 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* norfskarills combinations */
        .shared-norfskarills-greenfist {
            background: linear-gradient(45deg, #ffa500 50%, #00ff00 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-blacktooth {
            background: linear-gradient(45deg, #ffa500 50%, #ffffff 50%) !important;
            border: 4px solid #000000 !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-redskull {
            background: linear-gradient(45deg, #ffa500 50%, #8b0000 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        .shared-norfskarills-bonekrakka {
            background: linear-gradient(45deg, #ffa500 50%, #00ffff 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-thugskull {
            background: linear-gradient(45deg, #ffa500 50%, #ff69b4 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-rippa {
            background: linear-gradient(45deg, #ffa500 50%, #32cd32 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        .shared-norfskarills-scrapfist {
            background: linear-gradient(45deg, #ffa500 50%, #daa520 50%) !important;
            border: 4px solid #ffffff !important;
            color: #000000 !important;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8) !important;
        }

        /* Three-way control */
        .shared-three-way {
            background: repeating-linear-gradient(
                120deg,
                #ff0000 0%,
                #ff0000 33.33%,
                #ffff00 33.33%,
                #ffff00 66.66%,
                #800080 66.66%,
                #800080 100%
            ) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* Four-way control - Quadrant pattern */
        .shared-four-way {
            background: 
                linear-gradient(45deg, transparent 50%, var(--color4) 50%),
                linear-gradient(-45deg, var(--color3) 50%, transparent 50%),
                linear-gradient(135deg, transparent 50%, var(--color2) 50%),
                linear-gradient(-135deg, var(--color1) 50%, transparent 50%) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* Five-way control - Radial stripes */
        .shared-five-way {
            background: 
                conic-gradient(
                    from 0deg,
                    var(--color1) 0deg 72deg,
                    var(--color2) 72deg 144deg,
                    var(--color3) 144deg 216deg,
                    var(--color4) 216deg 288deg,
                    var(--color5) 288deg 360deg
                ) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* Six+ way control - Radial stripes with thin slices */
        .shared-many-way {
            background: 
                repeating-conic-gradient(
                    from 0deg,
                    #ff0000 0deg 15deg,
                    #ffff00 15deg 30deg,
                    #800080 30deg 45deg,
                    #ffa500 45deg 60deg,
                    #00ff00 60deg 75deg,
                    #ffffff 75deg 90deg,
                    #8b0000 90deg 105deg,
                    #00ffff 105deg 120deg,
                    #ff69b4 120deg 135deg,
                    #32cd32 135deg 150deg,
                    #daa520 150deg 165deg,
                    transparent 165deg 180deg
                ) !important;
            border: 4px solid #ffffff !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }

        /* Contested/neutral */
        .shared-contested {
            background: repeating-linear-gradient(
                45deg,
                #ffffff 0px,
                #ffffff 3px,
                transparent 3px,
                transparent 6px
            ) !important;
            border: 4px dashed #ffffff !important;
            color: #000000 !important;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8) !important;
        }

        /* Supply line styles */
        .supply-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, transparent, #00ff00, transparent);
            border-radius: 2px;
            opacity: 0.8;
            z-index: 5;
            pointer-events: none;
        }
        
        .supply-line.active {
            background: linear-gradient(90deg, transparent, #ffff00, transparent);
            box-shadow: 0 0 8px rgba(255,255,0,0.6);
            animation: supply-flow 2s infinite;
        }
        
        .supply-line.disrupted {
            background: linear-gradient(90deg, transparent, #ff0000, transparent);
            box-shadow: 0 0 8px rgba(255,0,0,0.6);
            animation: supply-disrupted 1s infinite;
        }
        
        .supply-line.naval {
            background: linear-gradient(90deg, transparent, #4682b4, transparent);
            height: 4px;
        }
        
        .supply-line.air {
            background: linear-gradient(90deg, transparent, #87ceeb, transparent);
            height: 2px;
            animation: supply-air 3s infinite;
        }
        
        @keyframes supply-flow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        @keyframes supply-disrupted {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        
        @keyframes supply-air {
            0%, 100% { transform: translateY(0px); opacity: 0.6; }
            50% { transform: translateY(-2px); opacity: 1; }
        }
        
        /* Supply depot markers */
        .supply-depot {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ffff00;
            border: 2px solid #00ff00;
            border-radius: 50%;
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 0 8px rgba(255,255,0,0.8);
        }
        
        /* Control level indicators */
        .control-contested { border-width: 2px !important; }
        .control-secured { border-width: 4px !important; }
        .control-fortified { border-width: 6px !important; box-shadow: 0 0 15px rgba(255,255,255,0.5) !important; }
        
        .title {
            text-align: center;
            font-size: 24px;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            background: linear-gradient(45deg, #ff0000, #ffff00, #ff0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .legend {
            position: absolute;
            top: 10px;
            right: -220px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,40,20,0.9));
            padding: 15px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            font-size: 10px;
            width: 200px;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 6px;
            border: 1px solid #ffffff;
            border-radius: 50%;
        }
        
        .tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(20,40,20,0.95));
            color: #00ff00;
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 8px;
            font-size: 11px;
            pointer-events: none;
            z-index: 1000;
            max-width: 220px;
            display: none;
            box-shadow: 0 0 15px rgba(0,255,0,0.5);
            font-family: 'Courier New', monospace;
        }
        
        /* Rivers/waterways */
        .river {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #4682b4, transparent);
            border-radius: 1px;
            opacity: 0.6;
        }
        
        .river1 {
            top: 40%;
            left: 25%;
            width: 35%;
            transform: rotate(25deg);
        }
        
        .river2 {
            top: 60%;
            left: 30%;
            width: 25%;
            transform: rotate(-15deg);
        }
    </style>
</head>
<body>
    <div class="title">PLANET KRONUS - DA BIGGEST WAAAGH! WORLD MAP</div>
    
    <div class="map-container">
        <!-- Geographic features -->
        <div class="continent"></div>
        
        <!-- Mountain ranges -->
        <div class="mountain-range mountains-north"></div>
        <div class="mountain-range mountains-central"></div>
        <div class="mountain-range mountains-south"></div>
        
        <!-- Desert areas -->
        <div class="desert-area desert-central"></div>
        <div class="desert-area desert-south"></div>
        
        <!-- Jungle areas -->
        <div class="jungle-area jungle-southwest"></div>
        <div class="jungle-area jungle-east"></div>
        
        <!-- Coastal lines -->
        <div class="coastline coast-north"></div>
        <div class="coastline coast-east"></div>
        
        <!-- Rivers -->
        <div class="river river1"></div>
        <div class="river river2"></div>
        
        <!-- STRONGHOLDS (Starting Territories) -->
        
        <!-- Norf Skar Fortress - Northern mountains -->
        <div class="territory stronghold mountain" style="top: 15%; right: 20%;" data-name="Norf Skar Fortress" data-type="Mountain Region - Stronghold" data-modifier="Fortifications: Attacker KRUMP halved" data-desc="A proppa 'ard fortress built into da mountains up north. Rocky walls and narrow passes.">
            NORF<br>SKAR
        </div>
        
        <!-- Victory Skar Bay - Eastern coast -->
        <div class="territory stronghold urban" style="top: 35%; right: 8%;" data-name="Victory Skar Bay" data-type="Urban Region - Stronghold" data-modifier="Zone Mortalis (3): Only 3 Mobz can fight here" data-desc="Big ruined city wiv lots of buildin's. Perfect fer close-up krumpin'.">
            VICTORY<br>BAY
        </div>
        
        <!-- Ice Grot Wastes - Northwestern frozen area -->
        <div class="territory stronghold death" style="top: 20%; left: 15%;" data-name="Ice Grot Wastes" data-type="Death Region - Stronghold" data-modifier="+10 KRUMP, -5 WAAAGH!" data-desc="Frozen wasteland where only da 'ardest Orks survive. Snow and ice everywhere.">
            ICE<br>WASTES
        </div>
        
        <!-- Big Boss Town - Central highlands -->
        <div class="territory stronghold civilized" style="top: 35%; left: 35%;" data-name="Big Boss Town" data-type="Civilized Region - Stronghold" data-modifier="+10 FAME, -5 TEEF" data-desc="Big fancy city in da 'ighlands. Lots of nice buildin's and defensible positions.">
            BIG BOSS<br>TOWN
        </div>
        
        <!-- Green Jungle Rok - Southwestern jungle -->
        <div class="territory stronghold jungle" style="bottom: 25%; left: 20%;" data-name="Green Jungle Rok" data-type="Jungle Region - Stronghold" data-modifier="Dense Foliage: Sneaky Gitz +1 warscore" data-desc="Tropical peninsula wiv thick jungle where a big Ork Rok crashed. Perfect fer ambushes.">
            JUNGLE<br>ROK
        </div>
        
        <!-- Corrupted Skar Peninsula - Southern peninsula -->
        <div class="territory stronghold death" style="bottom: 15%; right: 30%;" data-name="Corrupted Skar Peninsula" data-type="Death Region - Stronghold" data-modifier="+10 KRUMP, -5 WAAAGH!" data-desc="Twisted southern peninsula where weird fings 'appen. Da land seems angry.">
            CORRUPTED<br>SKAR
        </div>
        
        <!-- Sandy Tomb World - Central desert -->
        <div class="territory stronghold desert" style="top: 45%; left: 48%;" data-name="Sandy Tomb World" data-type="Desert Region - Stronghold" data-modifier="+10 TEEF, -5 KRUMP" data-desc="Big desert plateau in da middle wiv underground tunnels and ancient ruins.">
            TOMB<br>WORLD
        </div>
        
        <!-- CONTESTED TERRITORIES -->
        
        <!-- Northern territories -->
        <div class="territory contested mountain" style="top: 28%; right: 35%;" data-name="Norf Skar 'Ills" data-type="Mountain Territory" data-modifier="Difficult terrain" data-desc="Rocky 'ills leadin' down from northern mountains.">
            'ILLS
        </div>
        
        <div class="territory contested mek" style="top: 25%; right: 50%;" data-name="Makin' Stuff Coast" data-type="Mek Territory" data-modifier="+7 KRUMP, +7 TEEF, -4 FAME" data-desc="Coastal area wiv factories and workshops.">
            COAST
        </div>
        
        <div class="territory contested mountain" style="top: 35%; left: 25%;" data-name="Tall Rock Mines" data-type="Mountain Territory" data-modifier="Fortifications + Dense cover" data-desc="'Igh mountains wiv mines and tunnels.">
            MINES
        </div>
        
        <!-- Central territories -->
        <div class="territory contested mek" style="top: 40%; right: 25%;" data-name="Flying Machine Port" data-type="Mek Territory" data-modifier="+7 KRUMP, +7 TEEF, -4 FAME" data-desc="Big spaceport wiv flying machines and tech.">
            PORT
        </div>
        
        <div class="territory contested flatland" style="top: 50%; right: 40%;" data-name="Speed Freek Plains" data-type="Flatland Territory" data-modifier="Tank 'Eads and Bike Riders +1 warscore" data-desc="Big flat areas perfect fer racin' bikes and tanks.">
            PLAINS
        </div>
        
        <div class="territory contested flatland" style="top: 55%; left: 30%;" data-name="Tank Krumpin' Fields" data-type="Flatland Territory" data-modifier="Tank 'Eads and Bike Riders +1 warscore" data-desc="Big open grasslands where tank battles 'appen.">
            FIELDS
        </div>
        
        <div class="territory contested death" style="top: 60%; right: 20%;" data-name="Angry Desert" data-type="Death World Territory" data-modifier="+10 KRUMP, -5 WAAAGH!" data-desc="Barren wasteland where sometin' makes everyone angry.">
            ANGRY
        </div>
        
        <!-- Southern territories -->
        <div class="territory contested civilized" style="bottom: 45%; left: 40%;" data-name="Grub Fields" data-type="Civilized Territory" data-modifier="+10 FAME, -5 TEEF" data-desc="Farmin' areas wiv scattered settlements.">
            GRUB
        </div>
        
        <div class="territory contested jungle" style="bottom: 40%; left: 25%;" data-name="Learny Tree Place" data-type="Forest Territory" data-modifier="+10 WAAAGH!, -5 FAME" data-desc="Forests wiv old 'umie schools and libraries.">
            TREES
        </div>
        
        <div class="territory contested mountain" style="bottom: 35%; left: 45%;" data-name="Big Rock Pass" data-type="Mountain Territory" data-modifier="Fortifications: Natural defensive positions" data-desc="Narrow mountain passes fer stoppin' enemies.">
            PASS
        </div>
        
        <div class="territory contested desert" style="bottom: 30%; right: 15%;" data-name="'Ot Sand Desert" data-type="Desert Territory" data-modifier="+10 TEEF, -5 KRUMP" data-desc="Really 'ot desert wiv buried scrap.">
            SAND
        </div>
        
        <div class="territory contested desert" style="bottom: 45%; left: 15%;" data-name="Empty Rock Desert" data-type="Desert Territory" data-modifier="+10 TEEF, -5 KRUMP" data-desc="Desert wiv valuable rocks and metals buried everywhere.">
            ROCKS
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div style="font-weight: bold; margin-bottom: 8px; color: #ff0000;">TERRAIN TYPES</div>
            <div class="legend-item">
                <div class="legend-color mountain" style="background: radial-gradient(circle, #888888, #404040);"></div>
                <span>Mountain</span>
            </div>
            <div class="legend-item">
                <div class="legend-color desert" style="background: radial-gradient(circle, #daa520, #b8860b);"></div>
                <span>Desert</span>
            </div>
            <div class="legend-item">
                <div class="legend-color jungle" style="background: radial-gradient(circle, #32cd32, #228b22);"></div>
                <span>Jungle/Forest</span>
            </div>
            <div class="legend-item">
                <div class="legend-color urban" style="background: radial-gradient(circle, #a9a9a9, #696969);"></div>
                <span>Urban</span>
            </div>
            <div class="legend-item">
                <div class="legend-color death" style="background: radial-gradient(circle, #ff0000, #8b0000);"></div>
                <span>Death World</span>
            </div>
            <div class="legend-item">
                <div class="legend-color mek" style="background: radial-gradient(circle, #87ceeb, #4682b4);"></div>
                <span>Mek World</span>
            </div>
            <div class="legend-item">
                <div class="legend-color civilized" style="background: radial-gradient(circle, #da70d6, #dda0dd);"></div>
                <span>Civilized</span>
            </div>
            <div class="legend-item">
                <div class="legend-color flatland" style="background: radial-gradient(circle, #7cfc00, #9acd32);"></div>
                <span>Flatlands</span>
            </div>
            <div style="margin-top: 10px; font-weight: bold; color: #ffff00;">
                Large = Strongholds<br>
                Small = Contested
            </div>
            <div style="margin-top: 10px; font-weight: bold; color: #ff0000;">
                WAAAGH! COLORS:
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff0000;"></div>
                <span>Reginald</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffff00;"></div>
                <span>Twoferone</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #800080;"></div>
                <span>Loraghz Neckcrusha</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffa500;"></div>
                <span>Norf Skar 'Ills</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00ff00;"></div>
                <span>Greenfist</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffffff;"></div>
                <span>Blacktooth</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8b0000;"></div>
                <span>Redskull</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00ffff;"></div>
                <span>Bonekrakka</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff69b4;"></div>
                <span>Thugskull</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #32cd32;"></div>
                <span>Rippa</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #daa520;"></div>
                <span>Scrapfist</span>
            </div>
        </div>
    <div class="supply-line active" style="left: 76.2048%; top: 20.7207%; width: 17.3004%; transform: rotate(141.378deg); transform-origin: 0px 50%;"></div><div class="supply-line active" style="left: 62.6882%; top: 31.5192%; width: 15.2029%; transform: rotate(-168.727deg); transform-origin: 0px 50%;"></div><div class="supply-line active" style="left: 47.7786%; top: 28.5473%; width: 15.039%; transform: rotate(127.11deg); transform-origin: 0px 50%;"></div><div class="supply-line naval" style="left: 88.133%; top: 40.5405%; width: 15.7687%; transform: rotate(169.507deg); transform-origin: 0px 50%;"></div><div class="supply-line naval" style="left: 72.628%; top: 43.4122%; width: 17.9026%; transform: rotate(146.389deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 18.8253%; top: 25.6757%; width: 15.3757%; transform: rotate(56.2304deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 18.8253%; top: 25.6757%; width: 25.9946%; transform: rotate(93.072deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 23.7952%; top: 69.3694%; width: 13.2726%; transform: rotate(-74.3662deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 27.372%; top: 56.5878%; width: 15.7114%; transform: rotate(-18.3833deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 42.2816%; top: 51.6329%; width: 11.0863%; transform: rotate(63.3659deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 47.2515%; top: 61.5428%; width: 11.9238%; transform: rotate(-68.477deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 51.626%; top: 50.4505%; width: 34.8555%; transform: rotate(27.4126deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 82.5678%; top: 66.4977%; width: 20.7158%; transform: rotate(141.903deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 66.2651%; top: 79.2793%; width: 19.6456%; transform: rotate(-54.7697deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 38.7048%; top: 40.5405%; width: 16.2839%; transform: rotate(37.4863deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 32.3419%; top: 58.277%; width: 15.2631%; transform: rotate(12.3548deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 27.372%; top: 38.4572%; width: 30.4654%; transform: rotate(49.2675deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 17.4322%; top: 51.6329%; width: 18.8433%; transform: rotate(70.2646deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 57.7184%; top: 53.3221%; width: 25.8557%; transform: rotate(168.952deg); transform-origin: 0px 50%;"></div><div class="supply-line " style="left: 77.5979%; top: 63.232%; width: 22.2126%; transform: rotate(-153.504deg); transform-origin: 0px 50%;"></div><div class="supply-line disrupted" style="left: 38.7048%; top: 40.5405%; width: 22.9103%; transform: rotate(33.9103deg); transform-origin: 0px 50%;"></div><div class="supply-line disrupted" style="left: 72.628%; top: 43.4122%; width: 42.9411%; transform: rotate(159.747deg); transform-origin: 0px 50%;"></div><div class="supply-line air" style="left: 72.628%; top: 43.4122%; width: 34.0445%; transform: rotate(-175.161deg); transform-origin: 0px 50%;"></div><div class="supply-line air" style="left: 72.628%; top: 43.4122%; width: 22.15%; transform: rotate(161.473deg); transform-origin: 0px 50%;"></div><div class="supply-depot" style="left: 38.7048%; top: 40.5405%; transform: translate(-50%, -50%);"></div><div class="supply-depot" style="left: 72.628%; top: 43.4122%; transform: translate(-50%, -50%);"></div><div class="supply-depot" style="left: 51.626%; top: 50.4505%; transform: translate(-50%, -50%);"></div><div class="supply-depot" style="left: 88.133%; top: 40.5405%; transform: translate(-50%, -50%);"></div><div class="supply-depot" style="left: 18.8253%; top: 25.6757%; transform: translate(-50%, -50%);"></div></div>
    
    <!-- Tooltip -->
    <div class="tooltip" id="tooltip" style="display: none; left: 992.492px; top: 470.689px;">
                        <strong style="color: #ff0000;">Speed Freek Plains</strong><br>
                        <em style="color: #ffff00;">Flatland Territory</em><br>
                        <strong>Owner: Neutral</strong><br>
                        <strong>Modifier:</strong> Tank 'Eads and Bike Riders +1 warscore<br>
                        <br>Big flat areas perfect fer racin' bikes and tanks.
                    </div>
    
    <script>
        // Initialize tooltip functionality
        function initializeTooltips() {
            const territories = document.querySelectorAll('.territory');
            const tooltip = document.getElementById('tooltip');
            
            if (!tooltip) {
                console.error('Tooltip element not found!');
                return;
            }
            
            territories.forEach(territory => {
                territory.addEventListener('mouseenter', (e) => {
                    const rect = e.target.getBoundingClientRect();
                    const name = e.target.dataset.name;
                    const type = e.target.dataset.type;
                    const modifier = e.target.dataset.modifier;
                    const desc = e.target.dataset.desc;
                    
                    // Enhanced owner display
                    let ownerText;
                    if (e.target.dataset.owners) {
                        const owners = e.target.dataset.owners.split(',');
                        ownerText = `Shared by: ${owners.join(', ')}`;
                    } else if (e.target.dataset.owner) {
                        ownerText = `Owner: ${e.target.dataset.owner}`;
                    } else {
                        ownerText = 'Owner: Neutral';
                    }
                    
                    tooltip.innerHTML = `
                        <strong style="color: #ff0000;">${name}</strong><br>
                        <em style="color: #ffff00;">${type}</em><br>
                        <strong>${ownerText}</strong><br>
                        <strong>Modifier:</strong> ${modifier}<br>
                        <br>${desc}
                    `;
                    
                    tooltip.style.display = 'block';
                    tooltip.style.left = (rect.right + 10) + 'px';
                    tooltip.style.top = rect.top + 'px';
                    
                    // Adjust if tooltip goes off screen
                    if (rect.right + 240 > window.innerWidth) {
                        tooltip.style.left = (rect.left - 240) + 'px';
                    }
                    if (rect.top + 120 > window.innerHeight) {
                        tooltip.style.top = (rect.bottom - 120) + 'px';
                    }
                    
                    console.log('Tooltip should be visible:', name); // Debug log
                });
                
                territory.addEventListener('mouseleave', () => {
                    tooltip.style.display = 'none';
                });
            });
            
            // Handle window resize
            window.addEventListener('resize', () => {
                tooltip.style.display = 'none';
            });
            
            console.log(`Tooltips initialized for ${territories.length} territories`);
        }

        // Initialize tooltips when page loads
        document.addEventListener('DOMContentLoaded', initializeTooltips);
        initializeTooltips(); // Also call immediately in case DOM is already loaded
        
        // TERRITORIAL CONTROL FUNCTIONS
        
        // Enhanced function for shared control (FIXED VERSION)
        function claimTerritoryShared(territoryName, warbossArray, controlLevel = 'contested') {
            const territory = document.querySelector(`[data-name="${territoryName}"]`);
            if (territory) {
                // Clear existing ownership
                liberateTerritory(territoryName);
                
                // Color mapping for warbosses
                const colorMap = {
                    'reginald': '#ff0000',
                    'twoferone': '#ffff00', 
                    'loraghzneckcrusha': '#800080',
                    'norfskarills': '#ffa500',
                    'greenfist': '#00ff00',
                    'blacktooth': '#ffffff',
                    'redskull': '#8b0000',
                    'bonekrakka': '#00ffff',
                    'thugskull': '#ff69b4',
                    'rippa': '#32cd32',
                    'scrapfist': '#daa520'
                };
                
                // Normalize names for CSS classes
                const normalizedNames = warbossArray.map(name => 
                    name.toLowerCase()
                        .replace(/\s+/g, '')
                        .replace(/-/g, '')
                        .replace(/[^a-z0-9]/g, '')
                ).sort();
                
                let sharedClass;
                
                if (normalizedNames.length === 2) {
                    sharedClass = `shared-${normalizedNames[0]}-${normalizedNames[1]}`;
                } else if (normalizedNames.length === 3) {
                    sharedClass = 'shared-three-way';
                } else if (normalizedNames.length === 4) {
                    sharedClass = 'shared-four-way';
                    // Set CSS custom properties for colors
                    for (let i = 0; i < 4; i++) {
                        const color = colorMap[normalizedNames[i]] || '#666666';
                        territory.style.setProperty(`--color${i+1}`, color);
                    }
                } else if (normalizedNames.length === 5) {
                    sharedClass = 'shared-five-way';
                    // Set CSS custom properties for colors
                    for (let i = 0; i < 5; i++) {
                        const color = colorMap[normalizedNames[i]] || '#666666';
                        territory.style.setProperty(`--color${i+1}`, color);
                    }
                } else if (normalizedNames.length > 5) {
                    sharedClass = 'shared-many-way';
                    console.log(`${normalizedNames.length}-way control - using radial pattern`);
                } else {
                    console.error('Shared control requires at least 2 factions');
                    return;
                }
                
                territory.classList.add(sharedClass);
                territory.classList.add(`control-${controlLevel}`);
                territory.dataset.owners = warbossArray.join(',');
                territory.dataset.controlLevel = controlLevel;
                
                console.log(`${territoryName} now shared by: ${warbossArray.join(', ')} (${controlLevel})`);
                console.log(`Applied CSS class: ${sharedClass}`);
                console.log(`Normalized names: [${normalizedNames.join(', ')}]`);
                
            } else {
                console.error(`Territory "${territoryName}" not found`);
            }
        }

        // Enhanced liberateTerritory function (COMPLETE VERSION)
        function liberateTerritory(territoryName) {
            const territory = document.querySelector(`[data-name="${territoryName}"]`);
            if (territory) {
                // Remove all possible ownership classes
                const allClasses = Array.from(territory.classList);
                allClasses.forEach(className => {
                    if (className.startsWith('owned-by-') || className.startsWith('shared-') || className.startsWith('control-')) {
                        territory.classList.remove(className);
                    }
                });
                
                delete territory.dataset.owner;
                delete territory.dataset.owners;
                delete territory.dataset.controlLevel;
                
                console.log(`${territoryName} liberated`);
            }
        }

        // Get shared owners function
        function getSharedOwners(territoryName) {
            const territory = document.querySelector(`[data-name="${territoryName}"]`);
            if (territory && territory.dataset.owners) {
                return territory.dataset.owners.split(',');
            } else if (territory && territory.dataset.owner) {
                return [territory.dataset.owner];
            }
            return [];
        }

        // Enhanced claimTerritory function (FIXED for name normalization)
        function claimTerritory(territoryName, warbossName, controlLevel = 'contested') {
            const territory = document.querySelector(`[data-name="${territoryName}"]`);
            if (territory) {
                // Remove any existing ownership classes
                liberateTerritory(territoryName);
                
                // Normalize the warboss name (same as shared function)
                const normalizedName = warbossName.toLowerCase()
                    .replace(/\s+/g, '')           // Remove spaces  
                    .replace(/-/g, '')             // Remove hyphens
                    .replace(/[^a-z0-9]/g, '');    // Remove special characters
                
                // Add new ownership using normalized name
                territory.classList.add(`owned-by-${normalizedName}`);
                territory.classList.add(`control-${controlLevel}`);
                territory.dataset.owner = warbossName;
                territory.dataset.controlLevel = controlLevel;
                
                console.log(`${territoryName} claimed by ${warbossName} (${controlLevel})`);
                console.log(`Applied CSS class: owned-by-${normalizedName}`);
            } else {
                console.error(`Territory "${territoryName}" not found`);
            }
        }
        
        // SUPPLY LINE FUNCTIONS - ADDED
        function createSupplyLine(fromTerritory, toTerritory, type = 'normal') {
            const from = document.querySelector(`[data-name="${fromTerritory}"]`);
            const to = document.querySelector(`[data-name="${toTerritory}"]`);
            
            if (!from || !to) {
                console.error(`Territory not found: ${fromTerritory} or ${toTerritory}`);
                return null;
            }
            
            const fromRect = from.getBoundingClientRect();
            const toRect = to.getBoundingClientRect();
            const mapRect = document.querySelector('.map-container').getBoundingClientRect();
            
            const fromX = (fromRect.left + fromRect.width/2 - mapRect.left) / mapRect.width * 100;
            const fromY = (fromRect.top + fromRect.height/2 - mapRect.top) / mapRect.height * 100;
            const toX = (toRect.left + toRect.width/2 - mapRect.left) / mapRect.width * 100;
            const toY = (toRect.top + toRect.height/2 - mapRect.top) / mapRect.height * 100;
            
            const deltaX = toX - fromX;
            const deltaY = toY - fromY;
            let distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            // Prevent lines from extending beyond 75% of map width to avoid legend overlap
            if (fromX > 75 || toX > 75 || distance > 75) {
                distance = Math.min(distance, 75);
            }
            
            const line = document.createElement('div');
            line.className = `supply-line ${type}`;
            line.style.left = fromX + '%';
            line.style.top = fromY + '%';
            line.style.width = distance + '%';
            line.style.transform = `rotate(${angle}deg)`;
            line.style.transformOrigin = '0 50%';
            
            return line;
        }
        
        function createSupplyDepot(territoryName) {
            const territory = document.querySelector(`[data-name="${territoryName}"]`);
            if (!territory) return null;
            
            const rect = territory.getBoundingClientRect();
            const mapRect = document.querySelector('.map-container').getBoundingClientRect();
            
            const x = (rect.left + rect.width/2 - mapRect.left) / mapRect.width * 100;
            const y = (rect.top + rect.height/2 - mapRect.top) / mapRect.height * 100;
            
            const depot = document.createElement('div');
            depot.className = 'supply-depot';
            depot.style.left = x + '%';
            depot.style.top = y + '%';
            depot.style.transform = 'translate(-50%, -50%)';
            
            return depot;
        }
        
        function clearSupplyLines() {
            const existingLines = document.querySelectorAll('.supply-line');
            const existingDepots = document.querySelectorAll('.supply-depot');
            existingLines.forEach(line => line.remove());
            existingDepots.forEach(depot => depot.remove());
        }
        
        function showSupplyLines() {
            clearSupplyLines();
            const mapContainer = document.querySelector('.map-container');
            
            // Northern Network - Secure supply chain
            const line1 = createSupplyLine("Norf Skar Fortress", "Norf Skar 'Ills", "active");
            const line2 = createSupplyLine("Norf Skar 'Ills", "Makin' Stuff Coast", "active");
            const line3 = createSupplyLine("Makin' Stuff Coast", "Big Boss Town", "active");
            
            // Eastern Network - Naval and air superiority
            const line4 = createSupplyLine("Victory Skar Bay", "Flying Machine Port", "naval");
            const line5 = createSupplyLine("Flying Machine Port", "Speed Freek Plains", "naval");
            
            // Western Network - Ice Grot Wastes connections
            const line6 = createSupplyLine("Ice Grot Wastes", "Tall Rock Mines", "");
            const line7 = createSupplyLine("Ice Grot Wastes", "Empty Rock Desert", "");
            
            // Southern Network - Jungle to desert corridor
            const line8 = createSupplyLine("Green Jungle Rok", "Learny Tree Place", "");
            const line9 = createSupplyLine("Learny Tree Place", "Grub Fields", "");
            const line10 = createSupplyLine("Grub Fields", "Big Rock Pass", "");
            const line11 = createSupplyLine("Big Rock Pass", "Sandy Tomb World", "");
            
            // Desert Network - Eastern desert chain
            const line12 = createSupplyLine("Sandy Tomb World", "'Ot Sand Desert", "");
            const line13 = createSupplyLine("'Ot Sand Desert", "Corrupted Skar Peninsula", "");
            const line14 = createSupplyLine("Corrupted Skar Peninsula", "Angry Desert", "");
            
            // Central Network - Key connections
            const line15 = createSupplyLine("Big Boss Town", "Sandy Tomb World", "");
            const line16 = createSupplyLine("Tank Krumpin' Fields", "Big Rock Pass", "");
            const line17 = createSupplyLine("Tall Rock Mines", "Big Rock Pass", "");
            
            // Cross-network connections
            const line18 = createSupplyLine("Empty Rock Desert", "Green Jungle Rok", "");
            const line19 = createSupplyLine("Speed Freek Plains", "Tank Krumpin' Fields", "");
            const line20 = createSupplyLine("Angry Desert", "Speed Freek Plains", "");
            
            // Contested/Disrupted routes
            const line21 = createSupplyLine("Big Boss Town", "Speed Freek Plains", "disrupted");
            const line22 = createSupplyLine("Flying Machine Port", "Tank Krumpin' Fields", "disrupted");
            
            // Air supply routes (limited range to avoid legend)
            const line23 = createSupplyLine("Flying Machine Port", "Big Boss Town", "air");
            const line24 = createSupplyLine("Flying Machine Port", "Sandy Tomb World", "air");
            
            const allLines = [
                line1, line2, line3, line4, line5, line6, line7, line8, line9, line10,
                line11, line12, line13, line14, line15, line16, line17, line18, line19, line20,
                line21, line22, line23, line24
            ];
            
            allLines.filter(line => line !== null).forEach(line => mapContainer.appendChild(line));
            
            // Add supply depots at strategic locations
            const depot1 = createSupplyDepot("Big Boss Town");
            const depot2 = createSupplyDepot("Flying Machine Port");
            const depot3 = createSupplyDepot("Sandy Tomb World");
            const depot4 = createSupplyDepot("Victory Skar Bay");
            const depot5 = createSupplyDepot("Ice Grot Wastes");
            
            [depot1, depot2, depot3, depot4, depot5]
                .filter(depot => depot !== null)
                .forEach(depot => mapContainer.appendChild(depot));
            
            console.log("✓ Complete supply network established!");
            console.log("✓ All territories connected with proper supply routes");
            console.log("✓ Lines contained within map boundaries");
            console.log("✓ No overlap with legend area");
        }
        
        function hideSupplyLines() {
            clearSupplyLines();
            console.log("Supply lines cleared");
        }
        
        // Demo function for supply scenarios
        function demoSupplyScenario() {
            console.log("=== SUPPLY LINE DEMO ===");
            
            // Clear and set up territories
            document.querySelectorAll('.territory').forEach(t => liberateTerritory(t.dataset.name));
            
            // Northern Empire
            claimTerritory("Norf Skar Fortress", "Reginald", "fortified");
            claimTerritory("Norf Skar 'Ills", "Reginald", "secured");
            claimTerritory("Makin' Stuff Coast", "Reginald", "secured");
            
            // Eastern Coalition
            claimTerritory("Victory Skar Bay", "Twoferone", "fortified");
            claimTerritory("Flying Machine Port", "Twoferone", "secured");
            
            // Southern Alliance
            claimTerritory("Green Jungle Rok", "Loraghz Neckcrusha", "fortified");
            claimTerritory("Sandy Tomb World", "Loraghz Neckcrusha", "secured");
            claimTerritory("Corrupted Skar Peninsula", "Loraghz Neckcrusha", "secured");
            
            // Contested areas
            claimTerritoryShared("Big Boss Town", ["Reginald", "Twoferone"], "contested");
            claimTerritoryShared("Speed Freek Plains", ["Reginald", "Twoferone", "Loraghz Neckcrusha"], "contested");
            
            showSupplyLines();
            
            console.log("Supply scenario active - check the map!");
        }
        
        // Update multiple territories at once
        function updateMap(territoryData) {
            // territoryData = [{"territory": "Norf Skar Fortress", "owner": "Reginald", "control": "secured"}, ...]
            territoryData.forEach(data => {
                if (data.owners && Array.isArray(data.owners)) {
                    claimTerritoryShared(data.territory, data.owners, data.control || 'contested');
                } else {
                    claimTerritory(data.territory, data.owner, data.control || 'contested');
                }
            });
        }
        
        // Save current map state to JSON
        function saveMapState() {
            const territories = document.querySelectorAll('.territory');
            const mapState = Array.from(territories).map(t => ({
                name: t.dataset.name,
                owner: t.dataset.owner || null,
                owners: t.dataset.owners ? t.dataset.owners.split(',') : null,
                controlLevel: t.dataset.controlLevel || null
            }));
            return JSON.stringify(mapState, null, 2);
        }
        
        // Load map state from JSON
        function loadMapState(jsonState) {
            const mapState = JSON.parse(jsonState);
            // First clear all territories
            document.querySelectorAll('.territory').forEach(t => {
                liberateTerritory(t.dataset.name);
            });
            // Then apply new state
            mapState.forEach(territory => {
                if (territory.owners) {
                    claimTerritoryShared(territory.name, territory.owners, territory.controlLevel);
                } else if (territory.owner) {
                    claimTerritory(territory.name, territory.owner, territory.controlLevel);
                }
            });
        }
        
        // Get territories owned by a specific WAAAGH!
        function getTerritoriesByOwner(warbossName) {
            const territories = document.querySelectorAll(`[data-owner="${warbossName}"]`);
            const sharedTerritories = document.querySelectorAll(`[data-owners*="${warbossName}"]`);
            
            const ownedList = Array.from(territories).map(t => t.dataset.name);
            const sharedList = Array.from(sharedTerritories).map(t => t.dataset.name);
            
            return {
                owned: ownedList,
                shared: sharedList,
                all: [...ownedList, ...sharedList]
            };
        }
        
        // Make functions globally available for console use
        window.claimTerritory = claimTerritory;
        window.claimTerritoryShared = claimTerritoryShared;
        window.liberateTerritory = liberateTerritory;
        window.updateMap = updateMap;
        window.saveMapState = saveMapState;
        window.loadMapState = loadMapState;
        window.getTerritoriesByOwner = getTerritoriesByOwner;
        window.getSharedOwners = getSharedOwners;
        window.showSupplyLines = showSupplyLines;
        window.hideSupplyLines = hideSupplyLines;
        window.demoSupplyScenario = demoSupplyScenario;
        
        // Demo function to test multi-faction control
        function demoMultiFactionControl() {
            console.log("=== Testing Multi-Faction Control ===");
            
            // Clear the map first
            document.querySelectorAll('.territory').forEach(t => liberateTerritory(t.dataset.name));
            
            // Two-way control
            claimTerritoryShared("Speed Freek Plains", ["Reginald", "Twoferone"], "contested");
            
            // Three-way control
            claimTerritoryShared("Flying Machine Port", ["Reginald", "Twoferone", "Loraghz Neckcrusha"], "contested");
            
            // Four-way control - Quadrant pattern
            claimTerritoryShared("Tank Krumpin' Fields", ["Reginald", "Twoferone", "Norf Skar 'Ills", "Greenfist"], "secured");
            
            // Five-way control - Radial slices
            claimTerritoryShared("Big Boss Town", ["Reginald", "Twoferone", "Norf Skar 'Ills", "Greenfist", "Blacktooth"], "contested");
            
            // Massive 8-way control - Thin radial stripes
            claimTerritoryShared("Sandy Tomb World", [
                "Reginald", "Twoferone", "Loraghz Neckcrusha", "Norf Skar 'Ills", 
                "Greenfist", "Blacktooth", "Redskull", "Bonekrakka"
            ], "fortified");
            
            console.log("Check the map for different multi-faction patterns:");
            console.log("- Speed Freek Plains: 2-way diagonal");
            console.log("- Flying Machine Port: 3-way stripes"); 
            console.log("- Tank Krumpin' Fields: 4-way quadrants");
            console.log("- Big Boss Town: 5-way radial slices");
            console.log("- Sandy Tomb World: 8-way thin radial stripes");
        }
        
        window.demoSharedControl = demoMultiFactionControl;
        window.demoMultiFactionControl = demoMultiFactionControl;
        
        console.log("=== KRONUS MAP READY ===");
        console.log("Available functions:");
        console.log("- claimTerritory(name, owner, level)");
        console.log("- claimTerritoryShared(name, [owner1, owner2, ...], level)");
        console.log("- liberateTerritory(name)");
        console.log("- showSupplyLines() - Display complete supply network");
        console.log("- hideSupplyLines() - Clear supply routes");
        console.log("- demoSupplyScenario() - Full faction conflict + supply lines demo");
        console.log("- demoSharedControl() - Test 2-8 faction control patterns");
        console.log("- demoMultiFactionControl() - Same as above");
        console.log("- saveMapState() / loadMapState(json)");
        console.log("");
        console.log("✅ All original territory control functions preserved");
        console.log("✅ Supply line system added");
        console.log("✅ No changes to existing positioning or control logic");
        console.log("Try: showSupplyLines() to see the complete network!");
    </script>

</body></html>